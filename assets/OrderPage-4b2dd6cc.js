import{d as $,o as k,c as g,e as n,t as _,u as P,_ as j,l as Z,I as H,i as L,m as C,J as K,C as Q,D as M,E as A,H as O,F as G,j as X,g as U,B as Y,p as ee,h as te,q as se}from"./index-5083176d.js";import{n as J}from"./numberFormatter-3e9f9747.js";import{c as ae}from"./countTextFormatter-92d5bf07.js";const oe={class:"form__cart-order"},ne=$({__name:"OrderPageCart",props:{item:{}},setup(a){return(t,e)=>(k(),g("li",oe,[n("h3",null,_(t.item.Product.title),1),n("b",null,_(P(J)(t.item.Product.price))+" ₽",1),n("span",null,"Артикул: "+_(t.item.Product.id),1)]))}});const re=j(ne,[["__scopeId","data-v-80d088b4"]]);/*! maska v2.1.10 | (c) Alexander Shabunevich | Released under the MIT license */var le=Object.defineProperty,ie=(a,t,e)=>t in a?le(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,R=(a,t,e)=>(ie(a,typeof t!="symbol"?t+"":t,e),e);const I={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class N{constructor(t={}){R(this,"opts",{}),R(this,"memo",new Map);const e={...t};if(e.tokens!=null){e.tokens=e.tokensReplace?{...e.tokens}:{...I,...e.tokens};for(const s of Object.values(e.tokens))typeof s.pattern=="string"&&(s.pattern=new RegExp(s.pattern))}else e.tokens=I;Array.isArray(e.mask)&&(e.mask.length>1?e.mask=[...e.mask].sort((s,o)=>s.length-o.length):e.mask=e.mask[0]??""),e.mask===""&&(e.mask=null),this.opts=e}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(t){const e=this.findMask(t);if(this.opts.mask==null||e==null)return!1;const s=this.process(t,e).length;return typeof this.opts.mask=="string"?s>=this.opts.mask.length:typeof this.opts.mask=="function"?s>=e.length:this.opts.mask.filter(o=>s>=o.length).length===this.opts.mask.length}findMask(t){const e=this.opts.mask;if(e==null)return null;if(typeof e=="string")return e;if(typeof e=="function")return e(t);const s=this.process(t,e.slice(-1).pop()??"",!1);return e.find(o=>this.process(t,o,!1).length>=s.length)??""}escapeMask(t){const e=[],s=[];return t.split("").forEach((o,l)=>{o==="!"&&t[l-1]!=="!"?s.push(l-s.length):e.push(o)}),{mask:e.join(""),escaped:s}}process(t,e,s=!0){var o;if(e==null)return t;const l=`value=${t},mask=${e},masked=${s?1:0}`;if(this.memo.has(l))return this.memo.get(l);const{mask:u,escaped:c}=this.escapeMask(e),m=[],f=this.opts.tokens!=null?this.opts.tokens:{},r=this.isReversed()?-1:1,i=this.isReversed()?"unshift":"push",d=this.isReversed()?0:u.length-1,D=this.isReversed()?()=>p>-1&&h>-1:()=>p<u.length&&h<t.length,F=y=>!this.isReversed()&&y<=d||this.isReversed()&&y>=d;let V,b=-1,p=this.isReversed()?u.length-1:0,h=this.isReversed()?t.length-1:0;for(;D();){const y=u.charAt(p),v=f[y],w=(v==null?void 0:v.transform)!=null?v.transform(t.charAt(h)):t.charAt(h);if(!c.includes(p)&&v!=null){if(w.match(v.pattern)!=null)m[i](w),v.repeated?(b===-1?b=p:p===d&&p!==b&&(p=b-r),d===b&&(p-=r)):v.multiple&&(p-=r),p+=r;else if(v.multiple){const q=((o=m[h-r])==null?void 0:o.match(v.pattern))!=null,x=u.charAt(p+r);q&&x!==""&&f[x]==null?(p+=r,h-=r):m[i]("")}else w===V?V=void 0:v.optional&&(p+=r,h-=r);h+=r}else s&&!this.isEager()&&m[i](y),w===y&&!this.isEager()?h+=r:V=y,this.isEager()||(p+=r);if(this.isEager())for(;F(p)&&(f[u.charAt(p)]==null||c.includes(p));)s?m[i](u.charAt(p)):u.charAt(p)===t.charAt(h)&&(h+=r),p+=r}return this.memo.set(l,m.join("")),this.memo.get(l)}}const B=a=>JSON.parse(a.replaceAll("'",'"')),z=(a,t={})=>{const e={...t};return a.dataset.maska!=null&&a.dataset.maska!==""&&(e.mask=ue(a.dataset.maska)),a.dataset.maskaEager!=null&&(e.eager=S(a.dataset.maskaEager)),a.dataset.maskaReversed!=null&&(e.reversed=S(a.dataset.maskaReversed)),a.dataset.maskaTokensReplace!=null&&(e.tokensReplace=S(a.dataset.maskaTokensReplace)),a.dataset.maskaTokens!=null&&(e.tokens=pe(a.dataset.maskaTokens)),e},S=a=>a!==""?!!JSON.parse(a):!0,ue=a=>a.startsWith("[")&&a.endsWith("]")?B(a):a,pe=a=>{if(a.startsWith("{")&&a.endsWith("}"))return B(a);const t={};return a.split("|").forEach(e=>{const s=e.split(":");t[s[0]]={pattern:new RegExp(s[1]),optional:s[2]==="optional",multiple:s[2]==="multiple",repeated:s[2]==="repeated"}}),t};class de{constructor(t,e={}){R(this,"items",new Map),R(this,"beforeinputEvent",s=>{const o=s.target,l=this.items.get(o);l.isEager()&&"inputType"in s&&s.inputType.startsWith("delete")&&l.unmasked(o.value).length<=1&&this.setMaskedValue(o,"")}),R(this,"inputEvent",s=>{if(s instanceof CustomEvent&&s.type==="input"&&s.detail!=null&&typeof s.detail=="object"&&"masked"in s.detail)return;const o=s.target,l=this.items.get(o),u=o.value,c=o.selectionStart,m=o.selectionEnd;let f=u;if(l.isEager()){const r=l.masked(u),i=l.unmasked(u);i===""&&"data"in s&&s.data!=null?f=s.data:i!==l.unmasked(r)&&(f=i)}if(this.setMaskedValue(o,f),"inputType"in s&&(s.inputType.startsWith("delete")||c!=null&&c<u.length))try{o.setSelectionRange(c,m)}catch{}}),this.options=e,typeof t=="string"?this.init(Array.from(document.querySelectorAll(t)),this.getMaskOpts(e)):this.init("length"in t?Array.from(t):[t],this.getMaskOpts(e))}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.inputEvent),t.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdateOptions(t,e){const s=this.items.get(t),o=new N(z(t,this.getMaskOpts(e)));return JSON.stringify(s.opts)!==JSON.stringify(o.opts)}needUpdateValue(t){const e=t.dataset.maskaValue;return e==null&&t.value!==""||e!=null&&e!==t.value}getMaskOpts(t){const{onMaska:e,preProcess:s,postProcess:o,...l}=t;return l}init(t,e){for(const s of t){const o=new N(z(s,e));this.items.set(s,o),s.value!==""&&this.setMaskedValue(s,s.value),s.addEventListener("input",this.inputEvent),s.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(t,e){const s=this.items.get(t);this.options.preProcess!=null&&(e=this.options.preProcess(e));const o=s.masked(e),l=s.unmasked(s.isEager()?o:e),u=s.completed(e),c={masked:o,unmasked:l,completed:u};e=o,this.options.postProcess!=null&&(e=this.options.postProcess(e)),t.value=e,t.dataset.maskaValue=e,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(m=>m(c)):this.options.onMaska(c)),t.dispatchEvent(new CustomEvent("maska",{detail:c})),t.dispatchEvent(new CustomEvent("input",{detail:c}))}}const T=new WeakMap,ce=a=>{setTimeout(()=>{var t;((t=T.get(a))==null?void 0:t.needUpdateValue(a))===!0&&a.dispatchEvent(new CustomEvent("input"))})},W=(a,t)=>{const e=a instanceof HTMLInputElement?a:a.querySelector("input"),s={...t.arg};if(e==null||(e==null?void 0:e.type)==="file")return;ce(e);const o=T.get(e);if(o!=null){if(!o.needUpdateOptions(e,s))return;o.destroy()}if(t.value!=null){const l=t.value,u=c=>{l.masked=c.masked,l.unmasked=c.unmasked,l.completed=c.completed};s.onMaska=s.onMaska==null?u:Array.isArray(s.onMaska)?[...s.onMaska,u]:[s.onMaska,u]}T.set(e,new de(e,s))},E=a=>(ee("data-v-6673af3e"),a=a(),te(),a),me={class:"order"},he={class:"container order__container"},_e=E(()=>n("div",{class:"order__content-top"},null,-1)),fe={class:"order__content-form"},ve={class:"form__field"},ke={class:"form__data"},ge={class:"form__label"},ye=E(()=>n("span",{class:"form__value"},"ФИО",-1)),Ee={key:0,class:"form__error"},be={class:"form__label"},Me=E(()=>n("span",{class:"form__value"},"Адрес доставки",-1)),Ae={key:0,class:"form__error"},Oe={class:"form__label"},Pe=E(()=>n("span",{class:"form__value"},"Телефон",-1)),Re={key:0,class:"form__error"},we={class:"form__label"},Ve=E(()=>n("span",{class:"form__value"},"Email",-1)),Ce={key:0,class:"form__error"},Se={class:"form__label"},Te=E(()=>n("span",{class:"form__value"},"Комментарий к заказу",-1)),xe={key:0,class:"form__error"},Le={class:"form__cart"},Ue={class:"form__cart-orders"},Ie={class:"form__cart-total"},Ne=E(()=>n("button",{class:"form__cart-btn btn",type:"submit"}," Оформить заказ ",-1)),ze=$({__name:"OrderPage",setup(a){const t=Z(),e=H(),s=L({}),o=L({}),l=C(()=>t.state.cartProduct),u=C(()=>J(t.cartTotalPrice())),c=C(()=>t.cartTotalQuantity()),m=()=>{se.makeOrder(s.value.name,s.value.address,s.value.phone,s.value.email,s.value.comment,t.state.userAccessKey).then(r=>{t.updateOrderInfo(r.data),console.log(t.state.orderInfo),t.resetCart(),e.push({name:"/order/:id",params:{id:r.data.id}})})},f=K({tokens:{A:{pattern:/[A-ZА-ЯЁ]/,transform:r=>r.toLocaleUpperCase()},z:{pattern:/[a-zа-яё]/,transform:r=>r.toLocaleLowerCase(),multiple:!0},"#":{pattern:/[0-9]/},m:{pattern:/[a-z0-9-.]/,multiple:!0,transform:r=>r.toLocaleLowerCase()}},tokensReplace:!0});return(r,i)=>(k(),g("section",me,[n("div",he,[_e,n("section",fe,[n("form",{action:"#",method:"post",class:"form",onSubmit:i[6]||(i[6]=Q(d=>m(),["prevent"]))},[n("div",ve,[n("div",ke,[n("label",ge,[M(n("input",{"onUpdate:modelValue":i[0]||(i[0]=d=>s.value.name=d),"data-maska":"Az Az Az",class:"form__input",type:"text",name:"fullName",placeholder:"Введите ваше полное имя"},null,512),[[A,s.value.name],[P(W),void 0,f]]),ye,o.value?(k(),g("span",Ee,_(o.value.name),1)):O("",!0)]),n("label",be,[M(n("input",{"onUpdate:modelValue":i[1]||(i[1]=d=>s.value.address=d),class:"form__input",type:"text",name:"address",placeholder:"Введите ваш адрес"},null,512),[[A,s.value.address]]),Me,o.value?(k(),g("span",Ae,_(o.value.address),1)):O("",!0)]),n("label",Oe,[M(n("input",{"onUpdate:modelValue":i[2]||(i[2]=d=>s.value.phone=d),"data-maska":"+7(###)###-##-##",class:"form__input",type:"tel",name:"phone",placeholder:"Введите ваш телефон"},null,512),[[A,s.value.phone],[P(W),void 0,f]]),Pe,o.value?(k(),g("span",Re,_(o.value.phone),1)):O("",!0)]),n("label",we,[M(n("input",{"onUpdate:modelValue":i[3]||(i[3]=d=>s.value.email=d),class:"form__input",type:"text",name:"email",placeholder:"Введите ваш Email"},null,512),[[A,s.value.email]]),Ve,o.value?(k(),g("span",Ce,_(o.value.email),1)):O("",!0)]),n("label",Se,[M(n("textarea",{"onUpdate:modelValue":i[4]||(i[4]=d=>s.value.comment=d),class:"form__input form__input--area",name:"comments",placeholder:"Ваши пожелания"},null,512),[[A,s.value.comment]]),Te,o.value?(k(),g("span",xe,_(o.value.comment),1)):O("",!0)])])]),n("div",Le,[n("ul",Ue,[(k(!0),g(G,null,X(l.value,d=>(k(),Y(re,{key:d.Product.id,item:d},null,8,["item"]))),128))]),n("div",Ie,[n("p",null,[U(" Итого: "),n("b",null,_(c.value),1),U(" "+_(P(ae)(c.value))+" на сумму ",1),n("b",{onClick:i[5]||(i[5]=d=>console.log(P(t).state.orderInfo))},_(u.value)+" ₽",1)])]),Ne])],32)])])]))}});const Je=j(ze,[["__scopeId","data-v-6673af3e"]]);export{Je as default};
